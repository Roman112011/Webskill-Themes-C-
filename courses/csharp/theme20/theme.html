<html><head><title>Тема 20</title><meta charset="utf-8"><link rel="icon" href="../../../images/favicon.png" type="image/x-icon"><link rel='stylesheet' href='../../../styles/prism.css'><link rel='stylesheet' href='../../../styles/master.css'><link rel='stylesheet' href='styles/style.css'><script src='https://code.jquery.com/jquery-3.6.0.min.js' defer=""></script><script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js' defer=""></script><script src='../../../scripts/activate_highlight.js' defer=""></script><script src='../../../scripts/additional_content_button.js' defer=""></script></head><body><div id='templatemo_header_wrapper'>    <div id='templatemo_header'>        <div id='header'>            <br>            <h1 align='center'><a href='#' class='themeA'>Тема 20<br>GScraper та ImageSharp</a></h1><br>        </div>    </div></div><div class='content'><div class='theme-main-container debug-compile-info-cont' align='center'><p class='theme-main-header debug-compile-info-header'>Complie info</p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>ExecutableCreationTime</span>:<br><span class='debug-compile-info-entry-value attention-code'>03/27/2024 02:09:19</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>ExecutableLastWriteTime</span>:<br><span class='debug-compile-info-entry-value attention-code'>03/27/2024 02:09:19</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>ExecutableHashSHA256</span>:<br><span class='debug-compile-info-entry-value attention-code'>EF45B86474B6E4747501AAB037C01F7D6B1FE6DC5824305E2659CDA47943263A</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>SettingsHashSHA256</span>:<br><span class='debug-compile-info-entry-value attention-code'>F6D9CFAB2E7B5CC5152D66D4C0D51EC04FCF0BB9BE5A805C42FBABC64EACC089</span></p><br><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>AppStartDate</span>:<br><span class='debug-compile-info-entry-value attention-code'>2024-03-27 00:09:25.084</span></p><br><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>StylesHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>D874A857C9AE35986454587CF15ED802E0DA670AA6BCBF2B7311FA7D0367145E</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>ScriptsHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>B2860447F9AF448ED6C9353FCAD64AB324ABFB5D42697A9CA3F1A2C9535129E8</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>AdditionalHeadContentHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>CDB97F7F404FBF14B9786071235C8E643776E7B3C78B6A356497F4AFAF322B64</span></p><br><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>InfoMaterialThemeConfigStringHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>00078F90EC96B06F2F2C182D0EFB503D286D0BC64AB52F5305F09DE4178F46F9</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>HtmlTextFormaterStringHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>AB4ABAD693D95E41963BA8E2CAFF8E9C473154E175D0236A74FB1448106639B1</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>GlobalHtmlTextFormaterStringHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>0BD3178F0EB6CF62ED1234C263E422988E2A6CAE5285B6BB27A1CA5F526093C7</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>HeaderHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>9E4B3F1397C37693AF319C23C8F060DE91A17F60A58AFE3CAF18B2FF6C4ADD63</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>FooterHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>B8EA0644585A6D27C6B10FD167809CF1F1884EDC0374A494362B16876CE98B96</span></p><p class='theme-main-header debug-compile-info-entry'><span class='debug-compile-info-entry-name'>AdditionalMainDivContentHash</span>:<br><span class='debug-compile-info-entry-value attention-code'>D05224365F5F8632B8AC84C4032E59B7F61910A18D95DEB5F1C54140777D314C</span></p></div><div class="workaround-div-for-compile-only">    <div class="theme-main-container chapter-selector-container">        <a class="button-main chapter-selector-link" href="theme.html">            <p class="chapter-selector-text">Теорія</p>        </a>        <a class="button-main chapter-selector-link" href="tasks.html">            <p class="chapter-selector-text">Завдання</p>        </a>    </div></div><div class='theme-main-container' align='center'><p class='theme-main-header'>Практичне заняття - Поєднання GScraper та ImageSharp</p></div><div class='theme-main-container' align='center'><h1 class='theme-header'>Як використовувати <span class='attention-code'>GScraper</span>?</h1><p class='theme-text-container theme-text-container-info'><a class='theme-link' href='https://github.com/d4n3436/GScraper'>Офіційний <span class='attention-highlight'>GitHub</span> репозиторій <span class='attention-code'>GScraper</span></a></p><div class='theme-additional-content-container-main'><button class='button-main theme-additional-content-expander'>Показати</button><div class='theme-additional-content-container collapsed'><div class='code-and-explanation-container'><p class='theme-text-container theme-text-container-code-comment'>Офіційний приклад з репозиторію:</p><div class='code-pre-container'><pre><code class='language-cs'>using System;
using System.Collections.Generic;
using System.Net.Http;
using System.Text.Json;
using System.Threading.Tasks;
using GScraper;
using GScraper.Google;

namespace GScraperExample
{
    internal static class Program
    {
        private static async Task Main()
        {
            Console.WriteLine("GScraper Example Program"); // Виведення тексту в консоль про програму прикладу GScraper.
            using var scraper = new GoogleScraper(); // Створення об'єкту scraper типу GoogleScraper через using, який автоматично диспоузиться після виходу з області видимості.

            while (true) // Безкінечний цикл для отримання запитів користувача.
            {
                Console.Write("Query (enter 'e' to exit): "); // Виведення тексту запиту в консоль.
                string? text = Console.ReadLine(); // Отримання введення користувача з консолі.

                if (string.IsNullOrEmpty(text)) // Перевірка на пустий ввід.
                    continue; // Продовження циклу, якщо ввід порожній.

                if (text == "e") // Перевірка на вихід з програми.
                    break; // Вихід з циклу, якщо введено 'e'.

                IEnumerable&lt;IImageResult&gt; images; // Оголошення змінної для збереження списку зображень.

                try // Початок блоку спроби.
                {
                    images = await scraper.GetImagesAsync(text); // Отримання списку зображень за допомогою методу GetImagesAsync об'єкту scraper.
                }
                catch (Exception e) when (e is HttpRequestException or GScraperException) // Обробка винятків, що можуть виникнути під час виконання запиту.
                {
                    Console.WriteLine(e); // Виведення інформації про виняток у консоль.
                    continue; // Продовження циклу при виникненні винятку.
                }

                bool enumerateAll = false; // Ініціалізація змінної для переліку всіх зображень.
                bool stop = false; // Ініціалізація змінної для припинення переліку зображень.

                foreach (var image in images) // Цикл перебору зображень зі списку.
                {
                    Console.WriteLine(); // Порожній вивід у консоль для відділення зображень.
                    Console.WriteLine(JsonSerializer.Serialize(image, image.GetType(), new JsonSerializerOptions { WriteIndented = true })); // Виведення в консоль інформації про зображення у форматі JSON.

                    if (!enumerateAll) // Перевірка на перелік всіх зображень.
                    {
                        Console.Write("Press 'n' to send the next image, 'a' to enumerate all images and 's' to stop: "); // Виведення тексту запиту на подальші дії користувача.
                        var key = Console.ReadKey().Key; // Отримання введеного користувачем символу.

                        Console.WriteLine(); // Перехід на новий рядок у консолі.

                        switch (key) // Перевірка введеного символу користувача.
                        {
                            case ConsoleKey.A: // В разі введення 'a'.
                                enumerateAll = true; // Позначення переліку всіх зображень.
                                break;

                            case ConsoleKey.S: // В разі введення 's'.
                                stop = true; // Позначення припинення переліку зображень.
                                break;

                            default: // У всіх інших випадках.
                                break;
                        }
                    }

                    if (stop) // Перевірка на потребу в припиненні переліку.
                    {
                        break; // Вихід з циклу при необхідності припинення переліку зображень.
                    }
                }
            }
        }
    }
}
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Цей код представляє програму, яка використовує бібліотеку <span class='attention-code'>GScraper</span> для отримання зображень з Інтернету. Вона починає з виведення тексту про програму у консоль. Потім запускається нескінченний цикл, де користувач може вводити запити. Користувач може ввести 'e' для виходу з програми. Програма намагається отримати список зображень за допомогою обраного типу скрапера. Якщо виникає помилка під час отримання зображень, вона виводиться у консоль, і програма продовжує роботу. Потім програма перебирає список отриманих зображень, виводить їх інформацію у форматі JSON у консоль і чекає на введення користувача для подальших дій з кожним зображенням. Користувач може натискати 'n' для переходу до наступного зображення, 'a' для переліку всіх зображень або 's' для припинення перегляду. Програма завершу</p><p class='theme-text-container theme-text-container-code-comment'>Весь код на GoogleDrive:<a class='theme-a' href='https://drive.google.com/drive/folders/1BtNoDziW36YnuxRfYBxifd7jE718F0Ym?usp=sharing'>Посилання</a></p></div></div></div></div><div class='theme-main-container' align='center'><h1 class='theme-header'>Як використовувати <span class='attention-code'>GScraper</span>(або любий інший проєкт) у своїй програмі?</h1><p class='theme-text-container theme-text-container-info'>Підключення зовнішніх проєктів.</p><div class='theme-additional-content-container-main'><button class='button-main theme-additional-content-expander'>Показати</button><div class='theme-additional-content-container collapsed'><div class='code-and-explanation-container'><p class='theme-text-container theme-text-container-code-comment'>Зв'язок зовнішніх проєктів (.csproj та .sln) з іншим проєктом можна встановити за допомогою інструментів командного рядка (<code>dotnet add</code>) та редагування відповідних файлів.</p><p class='theme-text-container theme-text-container-code-comment'>Команда <code>dotnet add</code> використовується для додавання посилань на зовнішні проєкти до поточного проєкту. Наприклад:</p><div class='code-pre-container'><pre><code class='language-cs'>dotnet add reference шлях_до_зовнішнього_проєкту.csproj
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Крім цього, можна редагувати файли проєкту вручну:</p><div class='theme-additional-html-content-container'><ul class="theme-list"><li>Для .csproj: Відкрийте файл поточного проєкту (.csproj) у текстовому редакторі та вручну додайте посилання на зовнішній проєкт.</li><li>Для .sln: Відкрийте файл рішення (.sln) у текстовому редакторі та додайте посилання на зовнішній проєкт.</li></ul></div><p class='theme-text-container theme-text-container-code-comment'>У файлі .csproj можна додати наступний рядок:</p><div class='code-pre-container'><pre><code class='language-cs'>&lt;ItemGroup&gt;
    &lt;ProjectReference Include="шлях_до_зовнішнього_проєкту.csproj" /&gt;
&lt;/ItemGroup&gt;
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>У файлі .sln можна додати запис наступного вигляду:</p><div class='code-pre-container'><pre><code class='language-cs'>Project("{зовнішній_GUID}") = "Назва_проєкту", "шлях_до_зовнішнього_проєкту.csproj", "{унікальний_GUID}"
EndProject
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Це дозволить підключити зовнішній проєкт до вашого поточного проєкту, щоб ви могли використовувати його функціонал та ресурси у вашому програмному забезпеченні.</p></div></div></div></div><div class='theme-main-container' align='center'><h1 class='theme-header'>Приклад використання <span class='attention-code'>GScraper</span> з додатковою бібліотекою для роботи з ним</h1><p class='theme-text-container theme-text-container-info'><span class='attention-code'>GScraper</span> - призначення та використання.</p><div class='theme-additional-content-container-main'><button class='button-main theme-additional-content-expander'>Показати</button><div class='theme-additional-content-container collapsed'><div class='code-and-explanation-container'><p class='theme-text-container theme-text-container-code-comment'><strong>Пояснення роботи класів:</strong></p><div class='theme-additional-html-content-container'><ol class="theme-list"><li><p><strong><code>ScrapConfig</code> та <code>ScrapImageConfig</code>:</strong></p><ul class="theme-list-inside"><li><code>ScrapConfig</code> визначає конфігурацію для скрапінгу і містить список об'єктів <code>ScrapImageConfig</code>.</li><li><code>ScrapImageConfig</code> містить налаштування для пошуку конкретного типу зображень, такі як назва, кількість зображень для завантаження та формат імені файлу.</li></ul></li><li><p><strong><code>ScrapHendler</code>:</strong></p><ul class="theme-list-inside"><li><code>ScrapHendler</code> призначений для використання <code>GoogleScraper</code> та інших функцій для скрапінгу та завантаження зображень за заданою конфігурацією.</li><li>Метод <code>ScrapByScapConfig</code> цього класу приймає конфігурацію та вивідний каталог, створює папку виведення, і потім циклом скрапить та завантажить зображення для кожної конфігурації зі списку.</li><li><code>SearchForImage</code> використовує <code>GoogleScraper</code> для пошуку зображень за заданим текстом, вибирає до <code>maxReturnCount</code> зображень та повертає їх URL.</li><li><code>DownloadFileByURL</code> завантажує файл за заданим URL, використовуючи <code>HttpClient</code>, та зберігає його за вказаним шляхом та ім'ям файлу.</li></ul></li></ol></div><p class='theme-text-container theme-text-container-code-comment'><strong>Як використовувати ці класи:</strong></p><div class='theme-additional-html-content-container'><ol class="theme-list"><li>Створіть об'єкт <code>ScrapConfig</code> та додайте до нього об'єкти <code>ScrapImageConfig</code> з необхідними налаштуваннями.</li><li>Ініціалізуйте <code>GoogleScraper</code> та створіть об'єкт <code>ScrapHendler</code>, передаючи йому <code>GoogleScraper</code>.</li><li>Викличте метод <code>ScrapByScapConfig</code>, передаючи йому створений <code>ScrapConfig</code> та шлях для виведення.</li></ol></div><p class='theme-text-container theme-text-container-code-comment'><strong>Приклад використання:</strong></p><div class='code-pre-container'><pre><code class='language-cs'>class Program
{
    static void Main(string[] args)
    {
        // Створення та конфігурація для скрапінгу
        ScrapConfig scrapConfig = new ScrapConfig();
        scrapConfig.scrapImageConfigs.Add(new ScrapImageConfig("desert wallpaper", 5));
        scrapConfig.scrapImageConfigs.Add(new ScrapImageConfig("Strv 103B", 3));
        scrapConfig.scrapImageConfigs.Add(new ScrapImageConfig("Amx Elc Bis", 3));

        // Ініціалізація скрапера та обробника скрапінгу
        GoogleScraper scraper = new GoogleScraper();
        ScrapHendler scrapHendler = new ScrapHendler(scraper);

        // Виклик методу для скрапінгу за заданою конфігурацією та шляхом виводу
        scrapHendler.ScrapByScapConfig(scrapConfig, "output_folder");
    }
}
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Весь код на GoogleDrive:<a class='theme-a' href='https://drive.google.com/drive/folders/1wcdUzvJfSyTrChinkmbvuScCRV661jIc?usp=sharing'>Посилання</a></p></div></div></div></div><div class='theme-main-container' align='center'><h1 class='theme-header'>Приклад використання бібліотеки <span class='attention-highlight'>ImageSharp</span> у поєднанні з <span class='attention-highlight'>SimpleImageSharp</span></h1><p class='theme-text-container theme-text-container-info'><span class='attention-highlight'>ImageSharp</span> у поєднанні з <span class='attention-highlight'>SimpleImageSharp</span>.</p><div class='theme-additional-content-container-main'><button class='button-main theme-additional-content-expander'>Показати</button><div class='theme-additional-content-container collapsed'><div class='code-and-explanation-container'><p class='theme-text-container theme-text-container-code-comment'><a href='https://drive.google.com/drive/folders/1Re98eK22yQYsjD0zWhNDeW4DV1pW50qR?usp=sharing'>Посилання на проєкт</a>.</p><div class='theme-additional-html-content-container'><hr class='theme-line'></div><p class='theme-text-container theme-text-container-code-comment'><span class='attention-highlight'>Код проєкту</span>:</p><p class='theme-text-container theme-text-container-code-comment'>Наповнення файлу <span class='attention-highlight'>SimpleImageSharpExample.csproj</span>:</p><div class='code-pre-container'><pre><code class='language-xml'>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;

  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;

  &lt;ItemGroup&gt;
    &lt;PackageReference Include="SixLabors.ImageSharp" Version="3.1.2" /&gt;
    &lt;PackageReference Include="SixLabors.ImageSharp.Drawing" Version="2.1.0" /&gt;
  &lt;/ItemGroup&gt;

&lt;/Project&gt;
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Наповнення файлу <span class='attention-highlight'>Program.cs</span>:</p><div class='code-pre-container'><pre><code class='language-cs'>using SixLabors.ImageSharp;
using SixLabors.ImageSharp.Processing;
using SixLabors.ImageSharp.Drawing.Processing;
using SixLabors.Fonts;
using SimpleImageSharp;

class Program
{
    static void Main()
    {
        // Завантаження зображення
        using Image image = Image.Load("input.png");

        // Визначення параметрів прямокутника
        Pen pen = Pens.Solid(Color.Green, 20);
        Rectangle react = new Rectangle(image.Width / 2, image.Height / 2, 200, 200);

        // Малювання прямокутника
        SimpleImageSharpUtils.DrawRectangle(image, pen, react, true);

        // Визначення параметрів тексту
        FontCollection collection = new();
        FontFamily family = collection.Add("Hack-Regular.ttf");
        Font font = family.CreateFont(50, FontStyle.Italic);

        // Додавання тексту на зображення
        SimpleImageSharpUtils.DrawText(image, "test, fellas, just a test", font, Color.Red, image.Width / 2, image.Height / 2);

        // Додавання тексту із зазначенням шрифту
        SimpleImageSharpUtils.DrawTextHandleFont(image, "test, fellas, just a test (second)", "Hack-Regular.ttf", 10, Color.Red, image.Width / 2, image.Height / 2);

        // Масштабування зображення
        SimpleImageSharpUtils.ScaleImage(image, 1.5);

        // Збереження результату
        image.Save("output.png");
    }
}
</code></pre></div><p class='theme-text-container theme-text-container-code-comment'>Наповнення файлу <span class='attention-highlight'><span class='attention-highlight'>SimpleImageSharp</span>.cs</span>:</p><div class='code-pre-container'><pre><code class='language-cs'>using SixLabors.ImageSharp;
using SixLabors.ImageSharp.Processing;
using SixLabors.ImageSharp.Drawing.Processing;
using SixLabors.Fonts;


namespace SimpleImageSharp
{
    public class SimpleImageSharpUtils
    {
        public static void DrawRectangle(Image image, Pen pen, Rectangle react, bool center)
        {

            Rectangle drawRectangle;

            if (center)
            {
                drawRectangle = new Rectangle(react.X - react.Width / 2, react.Y - react.Height / 2, react.Width, react.Height);
            }
            else
            {
                drawRectangle = new Rectangle(react.X, react.Y, react.Width, react.Height);
            }

            image.Mutate(x =&gt; x.Draw(pen, drawRectangle));
        }

        public static void DrawText(Image image, string text, Font font, Color color, int x, int y)
        {
            Point point = new Point(x, y);
            image.Mutate(x =&gt; x.DrawText(text, font, color, point));
        }

        public static void DrawTextHandleFont(Image image, string text, string fontPath, int fontSize, Color color, int x, int y)
        {
            FontCollection collection = new();
            FontFamily family = collection.Add(fontPath);
            Font font = family.CreateFont(fontSize, FontStyle.Italic);
            DrawText(image, text, font, color, x, y);
        }

        public static void ResizeImage(Image image, int newWidth, int newHeight)
        {
            image.Mutate(x =&gt; x.Resize(newWidth, newHeight));
        }

        public static void ScaleImage(Image image, double fraction)
        {
            image.Mutate(x =&gt; x.Resize(Convert.ToInt32(image.Width * fraction), Convert.ToInt32(image.Height * fraction)));
        }

        public static void ToGrayscale(Image image)
        {
            image.Mutate(x =&gt; x.Grayscale());
        }
    }
}</code></pre></div><p class='theme-text-container theme-text-container-code-comment'><span class='attention-code-second'>Для роботи програми необхідні наступні файли:<br>1 - Шрифт (Hack-Regular.ttf)<br>2 - Зображення (input.png)</span></p></div></div></div></div></div><div id='templatemo_footer_wrapper'>    <div id='templatemo_footer'>Copyright © 2022 WebSkill - Всі права захищено.</div></div></body></html>